<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Daily Trademarks</title>
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/magnific-popup.css" />
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="js/isotope.pkgd.min.js"></script>
<script src="js/jquery.magnific-popup.min.js"></script>
<script src="//cdn.jsdelivr.net/jquery.lazyloadxt/1.0.0/jquery.lazyloadxt.min.js"></script>
</head>

<body>
<div id="header">See What People Want To Trademark Today</div>
<div class="container"></div>
<div id="marker"></div>
</body>
<script>

var $container = $('.container');
var start = 0;
var amount = 50;

$container.isotope({
  itemSelector: '.img_tile',
    masonry: {
      isFitWidth: true
    }
});

$.extend($.lazyLoadXT, {
  edgeY:  700,
  srcAttr: 'data-src'
});

$(document).ready(function() {

	$('#marker').on('lazyshow', function () {
		$.getJSON( '/trademark', {
			amount: amount,
		    start: start
		}).done(function( data ) {
		    $.each( data, function( i, item ) {
		    	//TODO check for correct answer
		    	var image = item.serial+'-'+item.image[0];
				var elem = $('<a href="images/'+image+'"  data-source="/trademark/'+item.serial+'" title="'+item.name+'" style="width:190px;height:190px;"><div class="img_tile"><div class="img_tile_overlay">'+item.serial+' - $ '+item.fee+'</div><span class="helper"></span><img data-src="images/'+image+'" style="max-height: 190px; max-width: 190px;" /></div></a>');
				$container.prepend(elem);
				$container.isotope( 'appended',elem);
				$container.isotope('layout');
		    });
			start += amount;
            $(window).lazyLoadXT();
            $('#marker').lazyLoadXT({visibleOnly: false, checkDuplicates: false});
		});
    }).lazyLoadXT({visibleOnly: false});

	$container.magnificPopup({
		delegate: 'a',
		type: 'image',
		closeOnContentClick: false,
		closeBtnInside: false,
		mainClass: 'mfp-with-zoom mfp-img-mobile',
		image: {
			verticalFit: true,
			titleSrc: function(item) {
				return item.el.attr('title') + ' &middot; <a class="image-source-link" href="'+item.el.attr('data-source')+'" target="_blank">image source</a>';
			}
		},
		gallery: {
			enabled: true
		},
		zoom: {
			enabled: true,
			duration: 300, // don't forget to change the duration also in CSS
			opener: function(element) {
				return element.find('img');
			}
		}
	})
});

</script>
</html>